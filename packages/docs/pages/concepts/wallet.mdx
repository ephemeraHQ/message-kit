# Agent Wallets

The `WalletService` class in MessageKit provides a way to create agent wallets that can perform gasless payments and transfers on Base.

## Introduction

To use the `WalletService`, you need to initialize it with Coinbase API credentials:

### Requirements

- `@coinbase/coinbase-sdk`: Already included in MessageKit
- `@coinbase/cbpay-js`: Already included in MessageKit
- Environment variables:
  - `COINBASE_APP_ID`: The Coinbase app id
  - `COINBASE_API_KEY_NAME`: The Coinbase API key name
  - `COINBASE_API_KEY_PRIVATE_KEY`: The Coinbase API private key

## Wallet Management

The `getWallet` method will retrieve an existing wallet or create a new one if it doesn't exist:

```typescript
// Get the wallet service
const { walletService } = context;

// Get or create a wallet
const wallet = await walletService.getWallet(walletAddress);
/*
Returns interface WalletServiceData {
  wallet: Wallet;
  address: string;
  agent_address: string;
  key: string;
}
*/

// Explicitly create a new wallet
const isCreated = await walletService.createWallet(walletAddress);

// Delete a wallet
await walletService.deleteWallet(walletAddress);
```

## Funds

Requesting and Withdrawing Funds from or to the Agent Wallet

```typescript
// Get the wallet service
const { walletService } = context;

// Request funds
await walletService.requestFunds(amount);
// This will send a payment request to the user with funding instructions

// Withdraw funds (optional amount parameter)
await walletService.withdrawFunds(amount);
// If amount is not specified, withdraws entire balance
```

### Actions

Perform actions on the Agent Wallet like transfers and swaps or checking the balance.

```typescript
// Get the wallet service
const { walletService } = context;

// Check balance
const balance = await walletService.checkBalance(walletAddress);

// Transfer between wallets
await walletService.transfer(walletAddress, walletAddress, amount);

// Swap assets
await walletService.swap(walletAddress, fromAssetId, toAssetId, amount);
```

## Security Architecture

The WalletService uses encryption with local file storage:

- Wallets are encrypted using the groupId as the encryption key
- Only people
- Data is stored locally in `.data/wallet-storage` directory
