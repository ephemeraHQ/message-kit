# Admin

This example shows how to manage your group metadata and members.

## Commands

Here are the commands to add and remove users:

```bash [cmd]
/admin add @alix
/admin remove @bo
/admin name "New Group Name"
```

::::note
:::details[Command declaration]

```json
{
  "name": "Admin",
  "icon": "ðŸ”",
  "description": "Moderate access to the group with admin commands.",
  "commands": [
    {
      "command": "/admin [type]",
      "description": "Add or remove a user.",
      "params": {
        "type": {
          "default": "",
          "type": "string",
          "values": ["add", "remove", "name"]
        },
        "username": {
          "default": "",
          "type": "username"
        },
        "address": {
          "default": "",
          "type": "address"
        },
        "name": {
          "default": "",
          "type": "quoted"
        }
      }
    }
  ]
}
```

:::
::::

## Main code

```jsx [src/handler/admin.ts]
import { HandlerContext } from "@xmtp/message-kit";

// Reusable function to handle adding members
function handleAddMembers(addedInboxes: any, members: any, adminName: any) {
  const addedNames = members
    ?.filter((member: any) =>
      addedInboxes.some(
        (added: any) =>
          added?.inboxId?.toLowerCase() === member?.inboxId?.toLowerCase(),
      ),
    )
    .map((member: any) => `@${member.username}`)
    .filter((name: any) => name.trim() !== "@") // Filter out empty or undefined usernames
    .join(", "); // Join names for message formatting

  if (addedNames && addedNames.trim().length > 0) {
    let messages = [
      `Yo, ${addedNames}! ðŸ«¡`, `LFG ${addedNames}!`, `${addedNames}ðŸ¤`,

    ];
    return messages[Math.floor(Math.random() * messages.length)];
  }
  return "";
}
function handleRemoveMembers(adminName: any) {
  let messages = [`ðŸª¦`, `â˜ ï¸â˜ ï¸â˜ ï¸`, `ðŸ‘»`, `hasta la vista, baby`];
  return messages[Math.floor(Math.random() * messages.length)];
}
const handleGroupname = (newValue: any, adminName: any) => {
  let messages = [
    `New name, new game '${newValue}'! ðŸ“`,
    `Nothing will be the same, all hail '${newValue}'!`,
  ];
  return messages[Math.floor(Math.random() * messages.length)];
};
export async function handler(context: HandlerContext) {
  const {
    conversation,
    members,
    message: { content, typeId },
  } = context;
  if (typeId === "group_updated") {
    const {
      initiatedByInboxId,
      metadataFieldChanges,
      removedInboxes,
      addedInboxes,
    } = content;
    // Fetch username from members array mapped by inboxId
    const adminName =
      members?.find((member) => member.inboxId === initiatedByInboxId)
        ?.username || "Admin";

    let message: string = "";
    if (addedInboxes.length > 0) {
      message += handleAddMembers(addedInboxes, members, adminName);
    } else if (removedInboxes.length > 0) {
      message += handleRemoveMembers(adminName);
    } else if (metadataFieldChanges && metadataFieldChanges[0]) {
      const { fieldName, newValue } = metadataFieldChanges?.[0];
      if (fieldName === "group_name") {
        message += handleGroupname(newValue, adminName);
      }
    }
    context.reply(message);
  } else if (typeId === "text") {
    const {
      params: { type, username, address, name },
    } = content;
    switch (type) {
      case "name":
        try {
          await conversation.updateName(name);
          const messages = handleGroupname(name, "bot");
          context.reply(messages);
        } catch (error) {
          context.reply("No admin privileges");
          console.error(error);
        }
        break;
      case "remove":
        try {
          const removedInboxes = username.map((user: any) => user.inboxId);
          if (!removedInboxes || removedInboxes.length === 0) {
            context.reply("Wrong username");
            return;
          }
          await conversation.sync();
          await conversation.removeMembersByInboxId(removedInboxes);
          const messages = handleRemoveMembers("bot");
          context.reply(messages);
        } catch (error) {
          context.reply("Error: Check admin privileges");
          console.error(error);
        }
        break;
      case "add":
        try {
          const addedInboxes = username.map((user: any) =>
            user?.inboxId?.toLowerCase(),
          );
          if (!addedInboxes || addedInboxes.length === 0) {
            context.reply("Wrong username");
            return;
          }
          await conversation.sync();
          await conversation.addMembersByInboxId(addedInboxes);
          await conversation.sync();
          const messages = handleAddMembers(
            [{ inboxId: addedInboxes[0] }],
            members,
            "bot",
          );
          context.reply(messages);
        } catch (error) {
          context.reply("Error: Check admin privileges");
          console.error(error);
        }
        break;
    }
  }
  return;
}
```
