# Group

This is a reference app that will allow you to understand the potential and all of its features. Through many handlers you will be able to understand different use case:

- [AI](/use-cases/group/ai): Reply with GPT when called by `@bot`.
- [Tipping](/use-cases/group/tipping): Tip when a user reacts with the `ðŸŽ©` emoji, replies `10 $degen` and `/tip`.
- [Betting](/use-cases/group/betting): Create a new group inside a group with `/bet`
- [Frame](/use-cases/group/frames): Handle commands like `/send`, `/swap`, `/mint`, `/show`.
- [Game](/use-cases/group/games): Handle frame games like `/game slot`, `/game wordle`
- [Admin](/use-cases/group/admin): Handle admin commands like `/block`, `/unblock`

## Structure

> Check out the [repository](https://github.com/xmtp-labs/message-kit/tree/main/examples/group) for the full code.

```
group/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Index file of the app. // [!code hl] // [!code focus]
â”‚   â”œâ”€â”€ command.ts            # For handling commands. // [!code hl] // [!code focus]
â”‚   â””â”€â”€ handler/
â”‚         â””â”€â”€ gpt.ts          # Handles gpt. // [!code hl] // [!code focus]
â”‚         â””â”€â”€ tipping.ts      # Handles tipping. // [!code hl] // [!code focus]
â”‚         â””â”€â”€ betting.ts          # Handles betting. // [!code hl] // [!code focus]
â”‚         â””â”€â”€ game.ts         # Handles game frames. // [!code hl] // [!code focus]
â”‚         â””â”€â”€ admin.ts        # Handles moderation. // [!code hl] // [!code focus]
â”‚         â””â”€â”€ frame.ts        # Handles the transaction frame. // [!code hl] // [!code focus]
â”‚   â””â”€â”€ lib/
â”‚         â””â”€â”€ gpt.ts          # Handles the openai logic. // [!code hl] // [!code focus]
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env
```

::::note[Commands]
To declare this commands you need to add them first. Learn more about commands [here](/concepts/commands).
:::details[Snippet]

```tsx [src/commands.ts]
interface CommandParamConfig {
  default?: any;
  type: "number" | "string" | "username" | "quoted" | "address";
  values?: string[]; // Accepted values for the parameter
}
interface CommandConfig {
  command: string;
  description: string;
  params: Record<string, CommandParamConfig>;
}

interface CommandGroup {
  name: string;
  icon: string;
  description: string;
  commands: CommandConfig[];
}

export const commands: CommandGroup[] = [
  {
    name: "Tipping",
    icon: "ðŸŽ©",
    description: "Tip tokens via emoji, replies or command.",
    commands: [
      {
        command: "/tip [@users] [amount] [token]",
        description: "Tip users in a specified token.",
        params: {
          username: {
            default: "",
            type: "username",
          },
          amount: {
            default: 10,
            type: "number",
          },
        },
      },
    ],
  },
  {
    name: "Base Transactions",
    icon: "ðŸ–¼ï¸",
    description: "Multipurpose transaction frame built onbase.",
    commands: [
      {
        command: "/send [amount] [token] [@username]",
        description:
          "Send a specified amount of a cryptocurrency to a destination address.",
        params: {
          amount: {
            default: 10,
            type: "number",
          },
          token: {
            default: "usdc",
            type: "string",
            values: ["eth", "dai", "usdc", "degen"], // Accepted tokens
          },
          username: {
            default: "",
            type: "username",
          },
        },
      },
      {
        command: "/swap [amount] [token_from] [token_to]",
        description: "Exchange one type of cryptocurrency for another.",
        params: {
          amount: {
            default: 10,
            type: "number",
          },
          token_from: {
            default: "usdc",
            type: "string",
            values: ["eth", "dai", "usdc", "degen"], // Accepted tokens
          },
          token_to: {
            default: "eth",
            type: "string",
            values: ["eth", "dai", "usdc", "degen"], // Accepted tokenss
          },
        },
      },
      {
        command: "/mint [collection_address] [token_id]",
        description: "Create (mint) a new token or NFT.",
        params: {
          collection: {
            default: "0x73a333cb82862d4f66f0154229755b184fb4f5b0",
            type: "address",
          },
          tokenId: {
            default: 1,
            type: "number",
          },
        },
      },
      {
        command: "/show",
        description: "Show the whole frame.",
        params: {},
      },
    ],
  },
  {
    name: "Betting",
    icon: "ðŸŽ°",
    description: "Betting on basebet.",
    commands: [
      {
        command: "/bet @users [Bet Name] [Bet Amount]",
        description: "Bet on basebet.",
        params: {
          username: {
            default: "",
            type: "username",
          },
          name: {
            default: "",
            type: "quoted",
          },
          amount: {
            default: 10,
            type: "number",
          },
        },
      },
    ],
  },
  {
    name: "Games",
    icon: "ðŸ•¹ï¸",
    description: "Provides various gaming experiences.",
    commands: [
      {
        command: "/game [type]",
        description: "Play a game.",
        params: {
          type: {
            default: "",
            type: "string",
            values: ["wordle", "slot"],
          },
        },
      },
    ],
  },
  {
    name: "Admin",
    icon: "ðŸ”",
    description: "Moderate access to the group with admin commands.",
    commands: [
      {
        command: "/admin [type]",
        description: "Add or remove a user.",
        params: {
          type: {
            default: "",
            type: "string",
            values: ["add", "remove", "name"],
          },
          username: {
            default: "",
            type: "username",
          },
          address: {
            default: "",
            type: "address",
          },
          name: {
            default: "",
            type: "quoted",
          },
        },
      },
    ],
  },
];
```

:::
::::

## Logic

```tsx [src/index.ts]
import "dotenv/config";
import { run, HandlerContext } from "@xmtp/message-kit";
import { commands } from "./commands.js";
import { handler as bet } from "./handler/betting.js";
import { handler as tipping } from "./handler/tipping.js";
import { handler as gpt } from "./handler/gpt.js";
import { handler as frame } from "./handler/frame.js";
import { handler as games } from "./handler/game.js";
import { handler as admin } from "./handler/admin.js";

const appConfig = {
  commands: commands,
};

// Main function to run the app
run(async (context: HandlerContext) => {
  const { content, typeId } = context.message;
  switch (typeId) {
    case "reaction":
      const { action, content: emoji } = content;
      if ((emoji == "degen" || emoji == "ðŸŽ©") && action == "added") {
        await tipping(context);
      }
      break;
    case "reply":
      const { content: reply } = content;
      if (reply.includes("$degen")) {
        await tipping(context);
      }
      break;
    case "group_updated":
      await admin(context);
      break;
    case "text":
      const { content: text } = content;
      if (text.startsWith("/tip")) {
        await tipping(context);
      } else if (text.startsWith("@bot")) {
        await gpt(context);
      } else if (text.startsWith("/bet")) {
        await bet(context);
      } else if (
        text.startsWith("/send") ||
        text.startsWith("/swap") ||
        text.startsWith("/mint") ||
        text.startsWith("/show")
      ) {
        await frame(context);
      } else if (text.startsWith("/game")) {
        await games(context);
      } else if (text.startsWith("/admin")) {
        console.log(text);
        await admin(context);
      } else if (text === "/help") {
        const intro =
          "Available experiences:\n" +
          commands
            .flatMap((app) => app.commands)
            .map((command) => `${command.command} - ${command.description}`)
            .join("\n") +
          "\nUse these commands to interact with specific apps.";
        context.reply(intro);
      }
  }
}, appConfig);
```

## Run the app

Follow the steps below to run the app

::::steps

### Setup

```bash [cmd]
# Clone the repo
git clone https://github.com/xmtp-labs/message-kit
# Go to the examples/group folder
cd examples/group
# Install the dependencies
yarn install
# Run the app
yarn build:watch
yarn start:watch
```

### Variables

Set up this variables in your app to connect to redis and xmtp

```bash [cmd]
KEY= # 0x... the private key of the app (with the 0x prefix)
XMTP_ENV=production # or `dev`
OPENAI_API_KEY= # your openai api key
```

::::
